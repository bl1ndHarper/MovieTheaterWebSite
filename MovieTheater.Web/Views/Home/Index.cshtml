@using MovieTheater.Web.ViewModels;
@model HomePageViewModel

@{
    ViewData["Title"] = "Keen-chick: кращий кінотеатр Дніпра";
}

@section Styles {
    <link rel="stylesheet" href="~/css/index.css" asp-append-version="true" />
}

@* TODO: remove this authorization testing form *@
<div style="display: none; padding: 20px; background-color: #f4f4f4; border-radius: 10px; max-width: 300px;">
    <p><strong>Статус авторизації:</strong></p>
    <p id="auth-status">
        @if (User.Identity?.IsAuthenticated == true)
        {
            if (User.IsInRole("Admin"))
            {
                <text>Ви адмін</text>
            }
            else
            {
                <text>Ви користувач</text>
            }
        }
        else
        {
            <text>Ви не авторизовані</text>
        }
    </p>

    <form method="post" asp-controller="Home" asp-action="LoginAsAdmin">
        <button class="btn btn-danger mb-2">Увійти як Адмін</button>
    </form>
    <form method="post" asp-controller="Home" asp-action="LoginAsUser">
        <button class="btn btn-primary mb-2">Увійти як Користувач</button>
    </form>
    <form method="post" asp-controller="Home" asp-action="Logout">
        <button class="btn btn-secondary">Вийти</button>
    </form>
</div>

  <div class="greetings-div " >
    <p class="greetings-text-big font-main"> Найкраще місце в Дніпрі для кіноманів</p>
    <p class="greetings-text-small font-secondary"> Keen-chick кожен день чекає 
        вас на показах найкращого кіно сьогодення!</p>
  </div>

  <div class="container ml-3 mt-3">
    <p class="new-movies-text font-main "> Гарячі новинки</p>
  </div>

  <div class="new-movies-container">

    

<div id="movieCarousel" class="carousel slide" >
    <div class="carousel-inner">
        @for (int i = 0; i < Model.LatestMovies.Count; i += 3)
        {
            <div class="carousel-item @(i == 0 ? "active" : "")">
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    @foreach (var movie in Model.LatestMovies.Skip(i).Take(3))
                    {
                        <div class="col ">
                            <div class="new-movie-card h-100">
                                <div class="card-img-container">
                                    <img class="card-img-top" src="@movie.ThumbnailUrl" />
                                </div>
                                <div class="card-text-content">
                                    <div class="movie-title-div">
                                        <p class="movie-title">@movie.Title</p>
                                    </div>
                                    <div class="genre-length-info-div row">
                                        <p class="movie-genre col text-start">@movie.Genre</p>
                                        <p class="movie-length col text-end">
                                            @(TimeSpan.FromMinutes(movie.Duration ?? 0).ToString(@"h\:mm"))
                                        </p>
                                    </div>
                                    <div class="star-rating">
                                        @{
                                            var rating = movie.ImdbRating / 2;
                                            var full = (int)Math.Floor(rating);
                                            var half = rating % 1 >= 0.5m;
                                            var empty = 5 - full - (half ? 1 : 0);

                                            for (int s = 0; s < full; s++) {
                                                <i class="fa-solid fa-star" style="color: #FFD43B;"></i>
                                            }
                                            if (half) {
                                                <i class="fa-solid fa-star-half-stroke" style="color: #FFD43B;"></i>
                                            }
                                            for (int s = 0; s < empty; s++) {
                                                <i class="fa-regular fa-star" style="color: #FFD43B;"></i>
                                            }
                                        }
                                    </div>
                                    <div class="movie-button-div">
                                        <a href="#" class="movie-button">Детальніше</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
    <button class="new-movie-btn btn-prev" data-bs-target="#movieCarousel" data-bs-slide="prev">←</button>
    <button class="new-movie-btn btn-next" data-bs-target="#movieCarousel" data-bs-slide="next">→</button>
</div>

   <div class="container mt-3 row" style=" padding-right: 10px;">
      <p class="new-movies-text font-main col-2 mt-4"> У прокаті</p>
    <div class="dates-container col-10">

      <div class="date-div">
        <span class="date-text"> 21.06</span>
        <a href="#" class="date-circle date-active"></a>
      </div>
      
      <div class="date-div">
        <span class="date-text"> 22.06</span>
        <a href="#" class="date-circle"></a>
      </div>

       <div class="date-div">
        <span class="date-text"> 23.06</span>
        <a href="#" class="date-circle"></a>
      </div>

      <div class="date-div">
        <span class="date-text"> 24.06</span>
        <a href="#" class="date-circle"></a>
      </div>

      <div class="date-div">
        <span class="date-text"> 25.06</span>
        <a href="#" class="date-circle"></a>
      </div>

      <div class="date-div">
        <span class="date-text "> 26.06</span>
        <a href="#" class="date-circle"></a>
      </div>

      <div class="date-div">
        <span class="date-text"> 27.06</span>
        <a href="#" class="date-circle"></a>
      </div>
      
       <div class="date-div date-next-week">
        <i class="fa-solid fa-chevron-up fa-rotate-90 next-week-btn"></i>
      </div>


    </div>

    <div class="filters-div mt-4">
      <div id ="genreDropdown" class="dropdown-div">
        <select class="dropdown-select">
          <option selected disabled hidden>Жанр</option>
          <option>Бойовик</option>
          <option>Драма</option>
          <option>Комедія</option>
          <option>Будь-який</option>
        </select>
        <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
      </div>

      <div id ="ratingDropdown" class="dropdown-div">
        <select class="dropdown-select">
          <option selected disabled hidden>Рейтинг</option>
          <option>12+</option>
          <option>16+</option>
          <option>18+</option>
          <option>Будь-який</option>
        </select>
        <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
      </div>

      <div id ="lengthDropdown" class="dropdown-div">
        <select class="dropdown-select">
          <option selected disabled hidden>Довжина</option>
          <option>Менше години</option>
          <option>1 год -2 год</option>
          <option>Більше 2 годин</option>
          <option>Будь-який</option>
        </select>
        <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
      </div>

        <div id ="searchInput" class="search-div">
          <input type="text" class="movie-search-input" placeholder="Назва фільму...">
      </div>


    </div>
 </div>

<div class="container" style="padding: 10px 2rem 0px 1.2rem;">
    @foreach (var movie in Model.AllSessions)
    {
        <div class="movie-session-card mt-3 row">
            <div class="poster-col col-auto">
                <img src="@movie.ThumbnailUrl" alt="@movie.Title" class="movie-thumb" />
            </div>

            <div class="flex-grow-1 col">
                <div class="title-sessiontimes-div container d-flex justify-content-between mb-5">
                    <div class="movie-title-div">
                        <span class="mb-2 session-movie-title font-main">@movie.Title</span>
                    </div>

                    <div class="session-times-block">
                        @foreach (var time in movie.Sessions)
                        {
                            <div class="session-time text-light-emphasis small">@time</div>
                        }
                    </div>
                </div>

                <div class="sessioninfo-booking-div container d-flex justify-content-between">
                    <div class="session-info text-muted small pt-2 font-secondary">
                        <span class="me-3"><i class="fa-solid fa-door-open me-1"></i> Зала 1</span>
                        <span class="me-3"><i class="fa-solid fa-child me-1"></i> @movie.AgeRating</span>
                        <span class="me-3"><i class="fa-solid fa-film me-1"></i> @movie.Genre</span>
                        <span><i class="fa-regular fa-clock me-1"></i> @(movie.Duration / 60):@(movie.Duration % 60)</span>
                    </div>

                        @{
                            var dayNow = DateTime.UtcNow.ToLocalTime().ToString("dd.MM");
                        }
                    <div class="booking-btn-div font-main">
                        <a asp-route="MovieSessionsRoute" asp-route-id="@movie.Id" asp-route-day="@dayNow" class="booking-btn">Забронювати</a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>


